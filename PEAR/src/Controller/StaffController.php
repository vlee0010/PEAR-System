<?php
namespace App\Controller;

use App\Model\Entity\Role;

class StaffController extends AppController
{
    public function initialize()
    {
        parent::initialize(); // TODO: Change the autogenerated stub
        $this->loadModel('Units');
        $this->loadModel('peer_reviews');
        $this->loadModel('Users');
        $this->loadModel('units_tutors');
        $this->loadModel('units_classes');
        $this->loadModel('students_classes');
        $this->loadModel('units_users');
        $this->loadModel('teams_users');
        $this->loadModel('teams');
        $this->loadModel('Classes');


    }

    public function isAuthorized($user)
    {
        // If you are a user, you can access this dashboard.
        return Role::isStaff($user['role']);
    }

    public function index()
    {
        $tutor_id=$this->Auth->user('id');
        $unit_id_list=$this->units_tutors->find('list',array('field',array('unit_id')))->where(['tutor_id'=>$tutor_id]);
        $unit_list=[];
        foreach($unit_id_list as $unit_id){
            array_push($unit_list,$this->Units->find()->where(['id'=>$unit_id])->first());
        }
        $this->set(compact('unit_list'));
    }
    public function displayclass($id=null){
        $class_id_list=$this->units_classes->find('list',array('field',array('class_id')))->where(['unit_id'=>$id]);
        $class_list=[];
        foreach ($class_id_list as $class_id){
            array_push($class_list,$this->Classes->find()->where(['id'=>$class_id])->first());
        }
        $this->set(compact('class_list'));
    }
    public function displaystudent($id=null){
        $student_id_list=$this->students_classes->find('list',array('field',array('student_id')))->where(['class_id'=>$id]);
        $student_list=[];
        foreach ($student_id_list as $student_id){
            array_push($student_list,$this->Users->find()->where(['id'=>$student_id])->first());
        }
        $this->set(compact('student_list'));

    }
}
